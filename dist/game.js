(()=>{"use strict";class e{constructor(e){this.maxspeed=5,this.speedY=5,this.width=15,this.height=15,this.player=e,this.position={x:this.player.position.x+e.width/2,y:this.player.position.y}}}class t{constructor(e){this.health=4,this.tempx=Math.floor(Math.random()*e),this.tempx>e-this.width&&(tempx=e-this.width),this.position={x:this.tempx,y:0},this.height=30,this.width=30,this.speedY=2}}const i=document.getElementById("game_screen").getContext("2d"),s=document.getElementById("side_screen").getContext("2d"),o=document.getElementById("control_pics").getContext("2d"),h=new Image;h.src="game/assets/images/projectile.png";const a=new Image;a.src="game/assets/images/person.png",(new Image).src="game/assets/images/tileset.png";const n=new Image;n.src="game/assets/images/lose_message.png";const l=new Image;l.src="game/assets/images/controls.png";const c=450,p=720;let r=new class{constructor(e,t){this.width=30,this.height=30,this.img_width=875,this.img_height=745,this.img_position_x=680,this.img_position_y=260,this.gameWidth=e,this.gameHeight=t,this.position={x:e/2-this.width/2,y:t-this.height-10},this.maxSpeed=5,this.Xspeed=0,this.Yspeed=0,this.lives=3,this.score=0}draw_lives(e,t){for(let i=0;i<this.lives;i+=1)e.drawImage(t,this.img_position_x,this.img_position_y,this.img_width,this.img_height,60*i,50,50,50)}draw(e,t){e.drawImage(t,this.img_position_x,this.img_position_y,this.img_width,this.img_height,this.position.x,this.position.y,this.width,this.height)}update(e){e&&(this.position.x+=this.Xspeed,this.position.y+=this.Yspeed,this.position.x<=0&&(this.position.x=0),this.position.x>=this.gameWidth-this.width&&(this.position.x=this.gameWidth-this.width),this.position.y<=0&&(this.position.y=0),this.position.y>=this.gameHeight-this.height&&(this.position.y=this.gameHeight-this.height))}moveLeft(){this.Xspeed=-this.maxSpeed}moveUp(){this.Yspeed=-this.maxSpeed}moveRight(){this.Xspeed=this.maxSpeed}moveDown(){this.Yspeed=this.maxSpeed}stopX(){this.Xspeed=0}stopY(){this.Yspeed=0}}(c,p),d=new class{projectiles=[];timerTillNextProjectile=0;constructor(e){this.player=e}draw(e,t,i){if(t.position.y<=0){let e=this.projectiles.indexOf(t);this.projectiles.splice(e,1)}else{let s=550,o=570;e.drawImage(i,0,0,s,o,t.position.x-t.width/2,t.position.y,t.width,t.height)}}update(e,t){e&&(t.position.y-=t.maxspeed)}shoot(){this.timerTillNextProjectile<=0&&this.projectiles.push(new e(this.player))}}(r),m=new class{constructor(e,t){this.enemies=[],this.GAME_HEIGHT=t,this.GAME_WIDTH=e,this.default_delay=150,this.spawn_delay=150}draw(e,t,i){if(t.position.y>=this.GAME_HEIGHT){let e=this.enemies.indexOf(t);this.enemies.splice(e,1),i.lives-=1}else{switch(t.health){case 4:e.fillStyle="green";break;case 3:e.fillStyle="yellow";break;case 2:e.fillStyle="orange";break;case 1:e.fillStyle="red"}e.fillRect(t.position.x,t.position.y,t.width,t.height)}}update(e,t){e&&(t.position.y+=t.speedY)}spawn(){0==this.spawn_delay&&(this.enemies.push(new t(this.GAME_WIDTH)),this.spawn_delay=this.default_delay,50!=this.default_delay&&(this.default_delay-=5)),this.spawn_delay-=1}}(c,p),g=new class{constructor(e,t){this.projectile_controller=e,this.enemy_controller=t}enemy_projectile_collision(e){this.projectile_controller.projectiles.forEach((t=>{this.enemy_controller.enemies.forEach((i=>{if(t.position.y<=i.position.y+i.height&&t.position.x+t.width>=i.position.x&&t.position.x<=i.position.x+i.width){let s=this.projectile_controller.projectiles.indexOf(t),o=this.enemy_controller.enemies.indexOf(i);1==i.health?(e.score+=100,this.projectile_controller.projectiles.splice(s,1),this.enemy_controller.enemies.splice(o,1)):(i.health-=1,this.projectile_controller.projectiles.splice(s,1))}}))}))}}(d,m);r.draw(i,a);let w=0;!function e(t){let y=t-w;if(w=t,0==r.lives)return s.clearRect(0,0,400,150),s.fillText("Score:",0,75),s.fillText(r.score,0,105),i.clearRect(0,0,c,p),void i.drawImage(n,490,580,1295,195,0,260,431,65);o.drawImage(l,150,230,1415,580,0,0,460,193),i.clearRect(0,0,c,p),s.clearRect(0,0,400,150),s.fillStyle="white",s.font="20px Arial",s.fillText("Lives",0,20,100),s.font="30px Arial",s.fillText(r.score,0,150,100),r.update(y),r.draw(i,a),r.draw_lives(s,a),m.spawn(),m.enemies.forEach((e=>{m.draw(i,e,r),m.update(y,e)})),d.projectiles.forEach((e=>{d.draw(i,e,h),d.update(y,e)})),g.enemy_projectile_collision(r),requestAnimationFrame(e)}(),new class{constructor(e,t){document.addEventListener("keydown",(t=>{switch(t.keyCode){case 37:case 65:e.moveLeft();break;case 38:case 87:e.moveUp();break;case 39:case 68:e.moveRight();break;case 40:case 83:e.moveDown()}})),document.addEventListener("keydown",(e=>{switch(e.keyCode){case 80:case 32:t.shoot()}})),document.addEventListener("keyup",(t=>{switch(t.keyCode){case 37:case 65:e.Xspeed<0&&e.stopX();break;case 38:case 87:e.Yspeed<0&&e.stopY();break;case 39:case 68:e.Xspeed>0&&e.stopX();break;case 40:case 83:e.Yspeed>0&&e.stopY()}})),document.addEventListener("keydown",(e=>{if(80===e.keyCode)return!0}))}}(r,d)})();